# ğŸ‰ Docker åˆå§‹åŒ–åŠŸèƒ½é›†æˆå®Œæˆ

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. **åˆ›å»ºå…¥å£è„šæœ¬** (`docker-entrypoint.sh`)
- âœ… è‡ªåŠ¨æ£€æµ‹å¹¶åˆå§‹åŒ–æ•°æ®åº“
- âœ… è‡ªåŠ¨æ£€æµ‹å¹¶åˆ›å»ºè´¦æœ¬æ–‡ä»¶
- âœ… æä¾›å‹å¥½çš„å¯åŠ¨æ—¥å¿—è¾“å‡º

### 2. **ä¿®æ”¹ Dockerfile**
- âœ… å¤åˆ¶å…¥å£è„šæœ¬åˆ°é•œåƒ
- âœ… è®¾ç½®è„šæœ¬æ‰§è¡Œæƒé™
- âœ… é…ç½® ENTRYPOINT å’Œ CMD

### 3. **æ›´æ–°æ–‡æ¡£**
- âœ… åˆ›å»ºè¯¦ç»†çš„ Docker åˆå§‹åŒ–æ–‡æ¡£ (`docs/docker-init.md`)
- âœ… æ›´æ–° Docker éƒ¨ç½²æŒ‡å— (`DOCKER.md`)
- âœ… æ·»åŠ ä½¿ç”¨è¯´æ˜å’Œæ•…éšœæ’é™¤

## ğŸš€ é‡æ–°éƒ¨ç½²æ­¥éª¤

### **é‡è¦æç¤º**
ç”±äºä¿®æ”¹äº†ä»¥ä¸‹æ–‡ä»¶ï¼Œéœ€è¦é‡æ–°æ„å»º Docker é•œåƒï¼š
- `docker-entrypoint.sh` (æ–°å¢)
- `Dockerfile` (ä¿®æ”¹)
- `frontend/src/api/client.ts` (ä¿®å¤ API baseURL)
- `backend/main.py` (è°ƒæ•´è·¯ç”±)

### éƒ¨ç½²å‘½ä»¤

```bash
# 1. åœæ­¢å¹¶åˆ é™¤ç°æœ‰å®¹å™¨
docker-compose down

# 2. é‡æ–°æ„å»ºé•œåƒï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼Œç¡®ä¿æ‰€æœ‰ä¿®æ”¹ç”Ÿæ•ˆï¼‰
docker-compose build --no-cache

# 3. å¯åŠ¨æ–°å®¹å™¨
docker-compose up -d

# 4. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼ˆéªŒè¯åˆå§‹åŒ–è¿‡ç¨‹ï¼‰
docker-compose logs -f beanmind
```

### æœŸæœ›çš„æ—¥å¿—è¾“å‡º

```
==========================================
ğŸš€ BeanMind å®¹å™¨å¯åŠ¨ä¸­...
==========================================

[1/3] æ£€æŸ¥æ•°æ®åº“...
ğŸ“¦ æ•°æ®åº“ä¸å­˜åœ¨ï¼Œæ­£åœ¨åˆå§‹åŒ–...
Creating all tables...
âœ… All tables created successfully!
âœ… Default user created successfully!
ğŸ‰ Database initialization completed!
âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ

[2/3] æ£€æŸ¥è´¦æœ¬æ–‡ä»¶...
ğŸ“„ è´¦æœ¬æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ­£åœ¨åˆ›å»º...
âœ… Ledger file created successfully!
âœ… è´¦æœ¬æ–‡ä»¶åˆ›å»ºå®Œæˆ

[3/3] å¯åŠ¨åº”ç”¨...
==========================================
ğŸ‰ åˆå§‹åŒ–å®Œæˆï¼Œæ­£åœ¨å¯åŠ¨æœåŠ¡...
==========================================

INFO:     Started server process [1]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

## ğŸ¯ éªŒè¯æ­¥éª¤

### 1. éªŒè¯å‰ç«¯é¡µé¢åŠ è½½

è®¿é—® `http://192.168.31.254:8000/`

- âœ… ä¸åº”å†è·³è½¬åˆ° `/login`ï¼ˆå¦‚æœ `auth_mode` æ˜¯ `none`ï¼‰
- âœ… åº”è¯¥èƒ½çœ‹åˆ°å‰ç«¯åº”ç”¨ç•Œé¢
- âœ… æµè§ˆå™¨æ§åˆ¶å°ä¸åº”æœ‰ `ERR_CONNECTION_REFUSED` é”™è¯¯

### 2. éªŒè¯ API è°ƒç”¨

```bash
# API æ¬¢è¿é¡µï¼ˆæ–°è·¯å¾„ï¼‰
curl http://192.168.31.254:8000/api

# å¥åº·æ£€æŸ¥
curl http://192.168.31.254:8000/health

# é…ç½®ä¿¡æ¯
curl http://192.168.31.254:8000/api/config
```

### 3. éªŒè¯æ•°æ®æ–‡ä»¶

```bash
# æ£€æŸ¥æ•°æ®ç›®å½•
ls -lh ./data/

# åº”è¯¥çœ‹åˆ°ï¼š
# beanmind.db          (æ•°æ®åº“æ–‡ä»¶)
# ledger/main.beancount (è´¦æœ¬æ–‡ä»¶)
```

### 4. éªŒè¯åˆå§‹åŒ–å¹‚ç­‰æ€§

```bash
# é‡å¯å®¹å™¨
docker-compose restart

# æŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥æ˜¾ç¤ºæ–‡ä»¶å·²å­˜åœ¨è€Œè·³è¿‡åˆå§‹åŒ–
docker-compose logs beanmind | grep "å·²å­˜åœ¨"
```

## ğŸ“ æœ¬æ¬¡ä¿®å¤çš„æ‰€æœ‰é—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | å½±å“çš„æ–‡ä»¶ |
|------|---------|-----------|
| å‰ç«¯ API è°ƒç”¨ä½¿ç”¨ localhost | ä¿®æ”¹ä¸ºä½¿ç”¨ç›¸å¯¹è·¯å¾„ | `frontend/src/api/client.ts` |
| æ ¹è·¯å¾„è¢« API å ç”¨ | å°† API æ¬¢è¿é¡µç§»åˆ° `/api` | `backend/main.py` |
| Docker éœ€è¦æ‰‹åŠ¨åˆå§‹åŒ– | é›†æˆè‡ªåŠ¨åˆå§‹åŒ–è„šæœ¬ | `docker-entrypoint.sh`, `Dockerfile` |

## ğŸ”§ ç›¸å…³æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- âœ… `docker-entrypoint.sh` - Docker å…¥å£è„šæœ¬
- âœ… `docs/docker-init.md` - Docker åˆå§‹åŒ–è¯¦ç»†æ–‡æ¡£
- âœ… `docs/fixes/frontend-api-baseurl-fix.md` - API baseURL ä¿®å¤æ–‡æ¡£

### ä¿®æ”¹æ–‡ä»¶
- âœ… `Dockerfile` - æ·»åŠ å…¥å£è„šæœ¬é…ç½®
- âœ… `frontend/src/api/client.ts` - ä¿®å¤ baseURL é€»è¾‘
- âœ… `backend/main.py` - è°ƒæ•´è·¯ç”±ä¼˜å…ˆçº§
- âœ… `DOCKER.md` - æ·»åŠ è‡ªåŠ¨åˆå§‹åŒ–è¯´æ˜

## ğŸ’¡ ç”¨æˆ·ä½“éªŒæå‡

### ä¹‹å‰çš„æµç¨‹
```bash
# 1. å¯åŠ¨å®¹å™¨
docker-compose up -d

# 2. æ‰‹åŠ¨è¿›å…¥å®¹å™¨
docker exec -it beanmind bash

# 3. æ‰‹åŠ¨åˆå§‹åŒ–æ•°æ®åº“
python -m backend.infrastructure.persistence.init_db

# 4. æ‰‹åŠ¨åˆå§‹åŒ–è´¦æœ¬
python -m backend.infrastructure.persistence.beancount.init_ledger

# 5. é‡å¯å®¹å™¨
docker-compose restart
```

### ç°åœ¨çš„æµç¨‹
```bash
# ä¸€é”®å¯åŠ¨ï¼Œè‡ªåŠ¨å®Œæˆæ‰€æœ‰åˆå§‹åŒ–ï¼
docker-compose up -d
```

## ğŸŠ æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¼˜åŒ–ï¼ŒBeanMind çš„ Docker éƒ¨ç½²ä½“éªŒå¾—åˆ°äº†æ˜¾è‘—æå‡ï¼š

1. **ğŸš€ ä¸€é”®éƒ¨ç½²**ï¼šæ— éœ€æ‰‹åŠ¨åˆå§‹åŒ–ï¼Œå®¹å™¨å¯åŠ¨å³å¯ç”¨
2. **ğŸ”§ è‡ªåŠ¨ä¿®å¤**ï¼šAPI è°ƒç”¨å’Œè·¯ç”±é—®é¢˜å·²å…¨éƒ¨è§£å†³
3. **ğŸ“– å®Œå–„æ–‡æ¡£**ï¼šæä¾›äº†è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œæ•…éšœæ’é™¤
4. **ğŸ’ª ç”Ÿäº§å°±ç»ª**ï¼šç¬¦åˆ Docker æœ€ä½³å®è·µï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

ç°åœ¨ç”¨æˆ·åªéœ€è¦ï¼š
```bash
git clone <repo>
cp .env.example .env
docker-compose up -d
```

å°±èƒ½å®Œæˆæ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹ï¼ğŸ‰
